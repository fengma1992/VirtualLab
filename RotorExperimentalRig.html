<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>转子实验台实验</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div class="main-div">
    <canvas id="mainCanvas" width="1000" height="300"></canvas>
    <div class="rowFlex-div">
        <div class="columnFlex-div">
            <span>信号波形</span>
            <canvas id="signalCanvas" width="500" height="200"></canvas>
            <span>信号频谱</span>
            <canvas id="frequencyCanvas" width="500" height="200"></canvas>
        </div>
        <div class="columnFlex-div">
            <span>轴心轨迹</span>
            <canvas id="orbitCanvas" width="430" height="430"></canvas>
        </div>
    </div>
    <br>
    <div class="rowFlex-div">
        <canvas id="knobCanvas" width="128" height="128"></canvas>
        <canvas id="roundPanelCanvas" width="128" height="128"></canvas>
        <select id="signalSelect" class="normal-select" onchange="setSignalType(this)">
            <option value="1">转速信号</option>
            <option value="2">加速度信号</option>
            <option value="3">轴心位移X信号</option>
            <option value="4">轴心位移Y信号</option>
        </select>
    </div>
    <div id="loadingDiv" class="loading-div">
        <img class="loading-img" src="img/loading.gif" alt="loading">
    </div>
</div>
<script src="js/VILibrary.js"></script>
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/three/three.js"></script>
<script src="js/three/MTLLoader.js"></script>
<script src="js/three/OBJLoader.js"></script>
<script src="js/three/controls/OrbitControls.js"></script>
<script src="js/three/ObjectControls.js"></script>

<script>
    'use strict';
    let signalWaveVI = new VILibrary.VI.WaveVI.createVI($('#signalCanvas'));
    let frequencyWaveVI = new VILibrary.VI.WaveVI.createVI($('#frequencyCanvas'));
    let orbitWaveVI = new VILibrary.VI.OrbitWaveVI.createVI($('#orbitCanvas'));
    let knobVI = new VILibrary.VI.KnobVI.createVI($('#knobCanvas'));
    let roundPanelVI = new VILibrary.VI.RoundPanelVI.createVI($('#roundPanelCanvas'));
    let RotorExperimentalRigVI = new VILibrary.VI.RotorExperimentalRigVI.createVI($('#mainCanvas'), true);

    signalWaveVI.setAxisRangX(0, RotorExperimentalRigVI.dataLength / 8192);//采样频率为8192
    signalWaveVI.setLabel('时间/s', '幅值');
    frequencyWaveVI.setAxisRangX(0, 4096);
    frequencyWaveVI.setLabel('频率/Hz', '幅值');
    knobVI.setDataRange(0, 6000, 4096); //转速表，调节转子试验台转速
    knobVI.attachEvent('mouseMove', function () {

        let rotateFrequency = (knobVI.singleOutput / 60).toFixed(1);
        roundPanelVI.setData(rotateFrequency);
        RotorExperimentalRigVI.setData(knobVI.singleOutput);
    });
    roundPanelVI.setRange(0, 100, 'Hz', '频率');

    function setSignalType (select) {

        RotorExperimentalRigVI.signalType = Number(select.value);
    }

    window.setInterval(function () {

        if (RotorExperimentalRigVI.isStart) {

            signalWaveVI.setData(RotorExperimentalRigVI.signalOutput);
            frequencyWaveVI.setData(RotorExperimentalRigVI.frequencyOutput);
            orbitWaveVI.setData([RotorExperimentalRigVI.orbitXOutput, RotorExperimentalRigVI.orbitYOutput]);
        }
    }, 50);
</script>
</body>
</html>