<!DOCTYPE html>
<html>
<head>
    <title>HTML5获取麦克风音频,输出到扬声器</title>
    <meta charset="UTF-8">
    <meta name="keywords" content="keyword1,keyword2,keyword3">
    <meta name="description" content="this is my page">
    <meta name="content-type" content="text/html; charset=UTF-8">
</head>
<body>
<input type="range" max="100" min="0" value="100" onmousemove="VolumeSample.changeVolume(this)">
<input type="button" onclick="VolumeSample.play()" value="开始">
<audio id="audio" autoplay="autoplay" controls="controls"></audio>
<script type="text/javascript">

    var audio = document.getElementById('audio');
    var context;
    try {
        context = new (window.AudioContext || window.webkitAudioContext)();
    }
    catch (e) {
        console.log("Your browser does not support AudioContext!");
    }
    var VolumeSample = {};
    // Gain node needs to be mutated by volume control.
    VolumeSample.gainNode = null;

    VolumeSample.play = function () {
        if (!context.createGain)
            context.createGain = context.createGainNode;
        this.gainNode = context.createGain();
        var source;
        navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia || navigator.msGetUserMedia);
        if (navigator.getUserMedia) {
            navigator.getUserMedia(
                    {
                        audio: true
                    },
                    function (stream) {
                        source = context.createMediaStreamSource(stream);
                        audio.srcObject = stream;
                        // Connect source to a gain node
//                        source.connect(VolumeSample.gainNode);
//                        // Connect gain node to destination
//                        VolumeSample.gainNode.connect(context.destination);
//                        // Start playback in a loop
//                        source.loop = true;
//                        if (!source.start)
//                            source.start = source.noteOn;
//                        source.start(0);
//                        this.source = source;
                    },
                    function (err) {
                        console.log("The following gUM error occured: " + err);
                    });
        }
        else {
            console.log("getUserMedia not supported on your browser!");
        }
    };
    var volume;
    VolumeSample.changeVolume = function (element) {
        if (volume == element.value)
            return;

        volume = element.value;
        var fraction = parseInt(element.value) / parseInt(element.max);
        // Let's use an x*x curve (x-squared) since simple linear (x) does not
        // sound as good.
        this.gainNode.gain.value = fraction * fraction;
    };

    VolumeSample.stop = function () {
        if (!this.source.stop)
            this.source.stop = source.noteOff;
        this.source.stop(0);
    };

    VolumeSample.toggle = function () {
        this.playing ? this.stop() : this.play();
        this.playing = !this.playing;
    };

    function logValue(input) {

        console.log(input.value);
    }
    function startAudio() {
        try {
            context = new (window.AudioContext || window.webkitAudioContext)();
        }
        catch (e) {
            console.log("Your browser does not support AudioContext!");
        }
        navigator.getUserMedia = (navigator.getUserMedia || navigator.webkitGetUserMedia ||
        navigator.mozGetUserMedia || navigator.msGetUserMedia);
        if (navigator.getUserMedia) {
            navigator.getUserMedia(
                    {
                        audio: true
                    },
                    function (stream) {
                        var source = context.createMediaStreamSource(stream);
                        var biquadFilter = context.createBiquadFilter();
                        biquadFilter.type = "lowshelf";
                        biquadFilter.frequency.value = 1000;
                        biquadFilter.gain.value = 25;
                        source.connect(biquadFilter);
                        biquadFilter.connect(context.destination);
                        source.stop(0);
                    },
                    function (err) {
                        console.log("The following gUM error occured: " + err);
                    });
        }
        else {
            console.log("getUserMedia not supported on your browser!");
        }
    }

</script>
</body>
</html>