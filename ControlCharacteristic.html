<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>典型环节控制特性分析</title>
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
<div class="mainDiv">
    <div>
        <canvas id="inputCanvas" width="1000" height="300"></canvas>
        <canvas id="outputCanvas" width="1000" height="300"></canvas>
    </div>
    <div class="rowFlexDiv">
        <canvas id="inputDataCanvas" width="50" height="30"></canvas>
        <canvas id="signalCanvas" width="50" height="30"></canvas>
        <button class="normalBtn" onclick="setStepType(1)">比例</button>
        <button class="normalBtn" onclick="setStepType(2)">积分</button>
        <button class="normalBtn" onclick="setStepType(3)">微分</button>
        <button class="normalBtn" onclick="setStepType(4)">惯性</button>
        <button class="normalBtn" onclick="setStepType(5)">震荡</button>
        <button class="normalBtn" onclick="setStepType(6)">比例积分</button>
        <button class="normalBtn" onclick="setStepType(7)">比例惯性</button>
        <button class="normalBtn" onclick="setStepType(8)">比例微分</button>
    </div>
</div>
<script src="js/VILibraries/WaveVI.js"></script>
<script src="js/VILibraries/StepResponseGeneratorVI.js"></script>
<script src="js/VILibraries/InputVI.js"></script>
<script>
    var inputCanvas = document.getElementById('inputCanvas');
    var outputCanvas = document.getElementById('outputCanvas');
    var signalCanvas = document.getElementById('signalCanvas');
    var inputDataCanvas = document.getElementById('inputDataCanvas');

    var inputWave = new WaveVI(inputCanvas);
    var outputWave = new WaveVI(outputCanvas);
    var inputData = new InputVI(inputDataCanvas);
    var signalGenerator = new StepResponseGeneratorVI(signalCanvas);

    var signalType = 1, n = 0;
    //    for (var i = 0; i < 1024; i++) {
    //        if (i < 10)
    //            input[i] = 0;
    //        else
    //            input[i] = 800;
    //    }

    function setStepType(type) {

        reset();
        signalType = type;

        switch (signalType) {

            case 1://比例
                signalGenerator.setStepType(1);
                signalGenerator.k1 = 1.5;
                break;

            case 2://积分
                signalGenerator.setStepType(2);
                signalGenerator.k2 = 5;
                break;

            case 3://微分
                signalGenerator.setStepType(3);
                signalGenerator.k3 = 0.0025;
                break;

            case 4://惯性
                signalGenerator.setStepType(6);
                signalGenerator.k1 = 0.025;
                break;

            case 5://震荡
                signalGenerator.setStepType(7);
                signalGenerator.k1 = 50;
                signalGenerator.k2 = 0.05;
                break;

            case 6://比例积分
                signalGenerator.setStepType(4);
                break;

            case 7://比例惯性
                signalGenerator.setStepType(8);
                signalGenerator.k1 = 0.025;
                signalGenerator.k2 = 1;
                break;

            case 8://比例微分
                signalGenerator.setStepType(5);
                signalGenerator.k3 = 0.0025;
                break;

            default:
                signalGenerator.setStepType(1);
                signalGenerator.k1 = 1.5;
                break;
        }
        window.setInterval(onTimer, 30);
    }

    function onTimer() {
        if (n < 10) {
            signalGenerator.setData(0);
            inputData.setData(0);
            n++;
        }
        else {
            signalGenerator.setData(800);
            inputData.setData(800);
        }

        outputWave.setData(signalGenerator.output, 1024);
        inputWave.setData(inputData.output, 1024);
    }

    function reset() {

        n = 0;
        inputData.reset();
        signalGenerator.reset();
    }
</script>

</body>
</html>